!function(e){function t(){var t=E.scrollLeft(),i=E.width();e([w,_]).css("left",t+i/2),g&&e(x).css({left:t,top:E.scrollTop(),width:i,height:E.height()})}function i(i){i?e("object").add(P?"select":"embed").each(function(e,t){D[e]=[t,t.style.visibility],t.style.visibility="hidden"}):(e.each(D,function(e,t){t[0].style.visibility=t[1]}),D=[]);var o=i?"bind":"unbind";E[o]("scroll resize",t),e(document)[o]("keydown",n)}function n(t){var i=t.which,n=e.inArray;return n(i,d.closeKeys)>=0?u():n(i,d.nextKeys)>=0?r():n(i,d.previousKeys)>=0?o():null}function o(){return a(f)}function r(){return a(m)}function a(e){return e>=0&&(A=e,h=p[A][0],f=(A||(d.loop?p.length:0))-1,m=(A+1)%p.length||(d.loop?0:-1),c(),w.className="lbLoading",N=new Image,N.onload=s,N.src=h),!1}function s(){w.className="",e(k).css({backgroundImage:"url("+h+")",visibility:"hidden",display:""}),e(C).width(N.width),e([C,T,S]).height(N.height),e(M).html(p[A][1]||""),e(F).html((p.length>1&&d.counterText||"").replace(/{x}/,A+1).replace(/{y}/,p.length)),f>=0&&(I.src=p[f][0]),m>=0&&(L.src=p[m][0]),y=k.offsetWidth,b=k.offsetHeight;var t=Math.max(0,v-b/2);w.offsetHeight!=b&&e(w).animate({height:b,top:t},d.resizeDuration,d.resizeEasing),w.offsetWidth!=y&&e(w).animate({width:y,marginLeft:-y/2},d.resizeDuration,d.resizeEasing),e(w).queue(function(){e(_).css({width:y,top:t+b,marginLeft:-y/2,visibility:"hidden",display:""}),e(k).css({display:"none",visibility:"",opacity:""}).fadeIn(d.imageFadeDuration,l)})}function l(){f>=0&&e(T).show(),m>=0&&e(S).show(),e(j).css("marginTop",-j.offsetHeight).animate({marginTop:0},d.captionAnimationDuration),_.style.visibility=""}function c(){N.onload=null,N.src=I.src=L.src=h,e([w,k,j]).stop(!0),e([T,S,k,_]).hide()}function u(){return A>=0&&(c(),A=f=m=-1,e(w).hide(),e(x).stop().fadeOut(d.overlayFadeDuration,i)),!1}var d,p,h,f,m,g,v,y,b,x,w,k,C,T,S,_,j,M,F,E=e(window),A=-1,P=!window.XMLHttpRequest,D=[],N=(document.documentElement,{}),I=new Image,L=new Image;e(function(){e("body").append(e([x=e('<div id="lbOverlay" />').click(u)[0],w=e('<div id="lbCenter" />')[0],_=e('<div id="lbBottomContainer" />')[0]]).css("display","none")),k=e('<div id="lbImage" />').appendTo(w).append(C=e('<div style="position: relative;" />').append([T=e('<a id="lbPrevLink" href="#" />').click(o)[0],S=e('<a id="lbNextLink" href="#" />').click(r)[0]])[0])[0],j=e('<div id="lbBottom" />').appendTo(_).append([e('<a id="lbCloseLink" href="#" />').click(u)[0],M=e('<div id="lbCaption" />')[0],F=e('<div id="lbNumber" />')[0],e('<div style="clear: both;" />')[0]])[0]}),e.slimbox=function(n,o,r){return d=e.extend({loop:!1,overlayOpacity:.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},r),"string"==typeof n&&(n=[[n,o]],o=0),v=E.scrollTop()+E.height()/2,y=d.initialWidth,b=d.initialHeight,e(w).css({top:Math.max(0,v-b/2),width:y,height:b,marginLeft:-y/2}).show(),g=P||x.currentStyle&&"fixed"!=x.currentStyle.position,g&&(x.style.position="absolute"),e(x).css("opacity",d.overlayOpacity).fadeIn(d.overlayFadeDuration),t(),i(1),p=n,d.loop=d.loop&&p.length>1,a(o)},e.fn.slimbox=function(t,i,n){i=i||function(e){return[e.href,e.title]},n=n||function(){return!0};var o=this;return o.unbind("click").click(function(){var r,a,s=this,l=0,c=0;for(r=e.grep(o,function(e,t){return n.call(s,e,t)}),a=r.length;a>c;++c)r[c]==s&&(l=c),r[c]=i(r[c],c);return e.slimbox(r,l,t)})}}(jQuery);